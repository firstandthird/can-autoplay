const fs = require('fs');
const mime = require('mime-types');
const path = require('path');

const videoFile = fs.readFileSync(path.resolve(process.cwd(), process.env.VIDEO));
const videoMimeType = mime.lookup(process.env.VIDEO);

const code = `// This file is generated. Do not edit this file directly.
// Command: 'npm run generate' should be used to update the content.

/**
 * @type {Blob}
 */
export default function getVideoBlob() {
  if (typeof window !== 'undefined') {
    return new Blob([new Uint8Array([${[...videoFile].join(', ')}])], { type: '${videoMimeType}' });
  }
}
`;

// eslint-disable-next-line no-console
console.log('Writing file...');

fs.writeFileSync(
  path.resolve(process.cwd(), process.env.OUTPUT),
  code,
  { encoding: 'utf8' }
);
